---
title: "ì™¸ë¶€ ì—°ë™ ëª…ì„¸ì„œ (Integration Specification)"
version: 1.0.0
last_updated: {{DATE}}
author: tsq-planner
status: draft
project: {{PROJECT_NAME}}
required_level: 3
---

# ì™¸ë¶€ ì—°ë™ ëª…ì„¸ì„œ (Integration Specification)

> ì™¸ë¶€ API, ì„œë“œíŒŒí‹° ì„œë¹„ìŠ¤, Webhook ì—°ë™ì„ ì •ì˜í•©ë‹ˆë‹¤.
> Level 3 (Enterprise) ë˜ëŠ” platform íƒ€ì… í”„ë¡œì íŠ¸ í•„ìˆ˜ ë¬¸ì„œì…ë‹ˆë‹¤.

---

## 1. ì—°ë™ ê°œìš”

### 1.1 ì—°ë™ ì„œë¹„ìŠ¤ ëª©ë¡

| ì„œë¹„ìŠ¤ | ìš©ë„ | ì œê³µì‚¬ | ìš°ì„ ìˆœìœ„ | ìƒíƒœ |
|-------|------|--------|:--------:|:----:|
| ê²°ì œ | ì¹´ë“œ/ê³„ì¢Œ ê²°ì œ | Stripe/Toss | P0 | ğŸ“‹ |
| ì¸ì¦ | OAuth ë¡œê·¸ì¸ | Google/Kakao | P1 | ğŸ“‹ |
| ì´ë©”ì¼ | ì•Œë¦¼/ë§ˆì¼€íŒ… | SendGrid | P1 | ğŸ“‹ |
| SMS | ì¸ì¦/ì•Œë¦¼ | Twilio | P2 | ğŸ“‹ |
| ìŠ¤í† ë¦¬ì§€ | íŒŒì¼ ì—…ë¡œë“œ | AWS S3 | P1 | ğŸ“‹ |
| ëª¨ë‹ˆí„°ë§ | ì—ëŸ¬ ì¶”ì  | Sentry | P1 | ğŸ“‹ |
| ë¶„ì„ | ì‚¬ìš©ì í–‰ë™ | Amplitude | P2 | ğŸ“‹ |

> ìƒíƒœ: ğŸ“‹ ê³„íš / ğŸš§ ê°œë°œ ì¤‘ / âœ… ì™„ë£Œ / â¸ï¸ ë³´ë¥˜

### 1.2 ì—°ë™ ì•„í‚¤í…ì²˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     {{PROJECT_NAME}}                         â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                Integration Layer                     â”‚   â”‚
â”‚  â”‚                                                       â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚   â”‚
â”‚  â”‚  â”‚ Payment  â”‚ â”‚  Auth    â”‚ â”‚ Storage  â”‚ ...        â”‚   â”‚
â”‚  â”‚  â”‚ Adapter  â”‚ â”‚ Adapter  â”‚ â”‚ Adapter  â”‚            â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜            â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚          â”‚            â”‚            â”‚                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚            â”‚            â”‚
           â–¼            â–¼            â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Stripe  â”‚ â”‚  Google  â”‚ â”‚  AWS S3  â”‚
    â”‚  Toss    â”‚ â”‚  Kakao   â”‚ â”‚          â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. ê²°ì œ ì—°ë™

### 2.1 ì„œë¹„ìŠ¤ ì •ë³´

| í•­ëª© | ê°’ |
|-----|---|
| **ì œê³µì‚¬** | Stripe / Toss Payments |
| **API ë²„ì „** | 2023-10-16 |
| **í™˜ê²½** | Sandbox (Dev/Staging) / Live (Prod) |
| **ë¬¸ì„œ** | https://stripe.com/docs/api |

### 2.2 ì§€ì› ê²°ì œ ìˆ˜ë‹¨

| ê²°ì œ ìˆ˜ë‹¨ | ì§€ì› | ë¹„ê³  |
|---------|:----:|------|
| ì‹ ìš©ì¹´ë“œ | âœ… | Visa, Master, Amex |
| ì²´í¬ì¹´ë“œ | âœ… | |
| ê³„ì¢Œì´ì²´ | âœ… | ì‹¤ì‹œê°„ |
| ê°€ìƒê³„ì¢Œ | âœ… | ë¬´í†µì¥ì…ê¸ˆ |
| ê°„í¸ê²°ì œ | âšª | ì¹´ì¹´ì˜¤í˜ì´, ë„¤ì´ë²„í˜ì´ |

### 2.3 API ì—”ë“œí¬ì¸íŠ¸

| ê¸°ëŠ¥ | Method | Endpoint | ì„¤ëª… |
|-----|--------|----------|------|
| ê²°ì œ ìƒì„± | POST | `/v1/payments` | ê²°ì œ ì˜ë„ ìƒì„± |
| ê²°ì œ í™•ì¸ | POST | `/v1/payments/{id}/confirm` | ê²°ì œ ìŠ¹ì¸ |
| ê²°ì œ ì·¨ì†Œ | POST | `/v1/payments/{id}/cancel` | ì „ì²´/ë¶€ë¶„ ì·¨ì†Œ |
| ê²°ì œ ì¡°íšŒ | GET | `/v1/payments/{id}` | ìƒíƒœ ì¡°íšŒ |
| í™˜ë¶ˆ ìš”ì²­ | POST | `/v1/refunds` | í™˜ë¶ˆ ì²˜ë¦¬ |

### 2.4 Webhook ì´ë²¤íŠ¸

| ì´ë²¤íŠ¸ | íŠ¸ë¦¬ê±° | ì²˜ë¦¬ |
|-------|-------|------|
| `payment.success` | ê²°ì œ ì„±ê³µ | ì£¼ë¬¸ ìƒíƒœ ì—…ë°ì´íŠ¸ |
| `payment.failed` | ê²°ì œ ì‹¤íŒ¨ | ì•Œë¦¼ ë°œì†¡, ì¬ì‹œë„ |
| `payment.refunded` | í™˜ë¶ˆ ì™„ë£Œ | ì¬ê³  ë³µì› |
| `payment.disputed` | ë¶„ìŸ ë°œìƒ | ê´€ë¦¬ì ì•Œë¦¼ |

### 2.5 ì—ëŸ¬ ì²˜ë¦¬

| ì—ëŸ¬ ì½”ë“œ | ì„¤ëª… | ëŒ€ì‘ |
|----------|------|------|
| `card_declined` | ì¹´ë“œ ê±°ì ˆ | ë‹¤ë¥¸ ê²°ì œ ìˆ˜ë‹¨ ì•ˆë‚´ |
| `insufficient_funds` | ì”ì•¡ ë¶€ì¡± | ê¸ˆì•¡ í™•ì¸ ì•ˆë‚´ |
| `expired_card` | ë§Œë£Œëœ ì¹´ë“œ | ì¹´ë“œ ì •ë³´ ì—…ë°ì´íŠ¸ |
| `processing_error` | ì²˜ë¦¬ ì˜¤ë¥˜ | ì¬ì‹œë„ (3íšŒ) |

---

## 3. ì¸ì¦ ì—°ë™ (OAuth)

### 3.1 ì§€ì› ì œê³µì

| ì œê³µì | Client ID | Scope | Callback URL |
|-------|-----------|-------|--------------|
| Google | `GOOGLE_CLIENT_ID` | email, profile | `/auth/google/callback` |
| Kakao | `KAKAO_CLIENT_ID` | profile, email | `/auth/kakao/callback` |
| Naver | `NAVER_CLIENT_ID` | name, email | `/auth/naver/callback` |
| Apple | `APPLE_CLIENT_ID` | name, email | `/auth/apple/callback` |

### 3.2 OAuth í”Œë¡œìš°

```
â”Œâ”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚Clientâ”‚     â”‚  Server â”‚     â”‚ Provider â”‚     â”‚    DB    â”‚
â””â”€â”€â”¬â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
   â”‚              â”‚               â”‚                â”‚
   â”‚  1. Login    â”‚               â”‚                â”‚
   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚               â”‚                â”‚
   â”‚              â”‚               â”‚                â”‚
   â”‚  2. Redirect â”‚               â”‚                â”‚
   â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚               â”‚                â”‚
   â”‚              â”‚               â”‚                â”‚
   â”‚  3. Auth Request             â”‚                â”‚
   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                â”‚
   â”‚              â”‚               â”‚                â”‚
   â”‚  4. Auth Codeâ”‚               â”‚                â”‚
   â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                â”‚
   â”‚              â”‚               â”‚                â”‚
   â”‚  5. Callback â”‚               â”‚                â”‚
   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚               â”‚                â”‚
   â”‚              â”‚  6. Token Exchange             â”‚
   â”‚              â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                â”‚
   â”‚              â”‚               â”‚                â”‚
   â”‚              â”‚  7. User Info â”‚                â”‚
   â”‚              â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                â”‚
   â”‚              â”‚               â”‚                â”‚
   â”‚              â”‚  8. Create/Update User         â”‚
   â”‚              â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>
   â”‚              â”‚               â”‚                â”‚
   â”‚  9. JWT      â”‚               â”‚                â”‚
   â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚               â”‚                â”‚
```

### 3.3 ì‚¬ìš©ì ë§¤í•‘

| Provider í•„ë“œ | ë‚´ë¶€ í•„ë“œ | ë¹„ê³  |
|--------------|----------|------|
| `sub` / `id` | `provider_id` | ê³ ìœ  ì‹ë³„ì |
| `email` | `email` | ì´ë©”ì¼ ê²€ì¦ í•„ìš” |
| `name` / `nickname` | `name` | |
| `picture` / `profile_image` | `avatar_url` | ì„ íƒì  |

---

## 4. ì´ë©”ì¼ ì—°ë™

### 4.1 ì„œë¹„ìŠ¤ ì •ë³´

| í•­ëª© | ê°’ |
|-----|---|
| **ì œê³µì‚¬** | SendGrid |
| **API ë²„ì „** | v3 |
| **ì¼ì¼ í•œë„** | 10,000 (Free), Unlimited (Paid) |

### 4.2 ì´ë©”ì¼ í…œí”Œë¦¿

| í…œí”Œë¦¿ ID | ìš©ë„ | íŠ¸ë¦¬ê±° |
|----------|------|--------|
| `welcome` | íšŒì›ê°€ì… í™˜ì˜ | ê°€ì… ì™„ë£Œ |
| `verify-email` | ì´ë©”ì¼ ì¸ì¦ | ê°€ì…/ë³€ê²½ ìš”ì²­ |
| `reset-password` | ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì • | ì¬ì„¤ì • ìš”ì²­ |
| `order-confirm` | ì£¼ë¬¸ í™•ì¸ | ê²°ì œ ì™„ë£Œ |
| `order-shipped` | ë°°ì†¡ ì•Œë¦¼ | ë°°ì†¡ ì‹œì‘ |

### 4.3 API ì‚¬ìš©

```typescript
// ì´ë©”ì¼ ë°œì†¡
interface SendEmailRequest {
  to: string;
  template_id: string;
  dynamic_template_data: Record<string, any>;
}

// POST /v3/mail/send
```

---

## 5. íŒŒì¼ ìŠ¤í† ë¦¬ì§€ ì—°ë™

### 5.1 ì„œë¹„ìŠ¤ ì •ë³´

| í•­ëª© | ê°’ |
|-----|---|
| **ì œê³µì‚¬** | AWS S3 |
| **ë¦¬ì „** | ap-northeast-2 |
| **ë²„í‚·** | `{{PROJECT_NAME}}-{env}` |

### 5.2 í´ë” êµ¬ì¡°

```
s3://{{PROJECT_NAME}}-prod/
â”œâ”€â”€ uploads/              # ì‚¬ìš©ì ì—…ë¡œë“œ
â”‚   â”œâ”€â”€ images/
â”‚   â”œâ”€â”€ documents/
â”‚   â””â”€â”€ temp/
â”œâ”€â”€ assets/               # ì •ì  ìì‚°
â”‚   â”œâ”€â”€ images/
â”‚   â””â”€â”€ fonts/
â””â”€â”€ backups/              # ë°±ì—…
```

### 5.3 ì—…ë¡œë“œ ì •ì±…

| í•­ëª© | ê°’ |
|-----|---|
| ìµœëŒ€ íŒŒì¼ í¬ê¸° | 10MB (ì´ë¯¸ì§€), 50MB (ë¬¸ì„œ) |
| í—ˆìš© í˜•ì‹ | jpg, png, gif, pdf, docx, xlsx |
| ì—…ë¡œë“œ ë°©ì‹ | Pre-signed URL |
| ë§Œë£Œ ì‹œê°„ | 15ë¶„ |

### 5.4 Pre-signed URL í”Œë¡œìš°

```
â”Œâ”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚Clientâ”‚     â”‚  Server â”‚     â”‚   S3    â”‚
â””â”€â”€â”¬â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
   â”‚              â”‚               â”‚
   â”‚ 1. Request URL               â”‚
   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚               â”‚
   â”‚              â”‚               â”‚
   â”‚              â”‚ 2. Generate   â”‚
   â”‚              â”‚   Pre-signed  â”‚
   â”‚              â”‚               â”‚
   â”‚ 3. Return URLâ”‚               â”‚
   â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚               â”‚
   â”‚              â”‚               â”‚
   â”‚ 4. Direct Upload             â”‚
   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
   â”‚              â”‚               â”‚
   â”‚ 5. Upload Complete           â”‚
   â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
   â”‚              â”‚               â”‚
   â”‚ 6. Confirm   â”‚               â”‚
   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚               â”‚
```

---

## 6. Webhook ìˆ˜ì‹ 

### 6.1 ê³µí†µ ì„¤ì •

| í•­ëª© | ê°’ |
|-----|---|
| ì—”ë“œí¬ì¸íŠ¸ | `/webhooks/{provider}` |
| ì¸ì¦ | Signature ê²€ì¦ |
| ì¬ì‹œë„ | 3íšŒ (exponential backoff) |
| íƒ€ì„ì•„ì›ƒ | 30ì´ˆ |

### 6.2 Webhook ë³´ì•ˆ

```typescript
// Signature ê²€ì¦ ì˜ˆì‹œ (Stripe)
function verifyWebhook(payload: string, signature: string): boolean {
  const expectedSig = crypto
    .createHmac('sha256', process.env.WEBHOOK_SECRET)
    .update(payload)
    .digest('hex');

  return crypto.timingSafeEqual(
    Buffer.from(signature),
    Buffer.from(expectedSig)
  );
}
```

### 6.3 ë©±ë“±ì„± ì²˜ë¦¬

| ì²˜ë¦¬ | ì„¤ëª… |
|-----|------|
| Event ID ì €ì¥ | DBì— ì²˜ë¦¬ëœ ì´ë²¤íŠ¸ ê¸°ë¡ |
| ì¤‘ë³µ ì²´í¬ | ë™ì¼ ID ì¬ìˆ˜ì‹  ì‹œ ë¬´ì‹œ |
| ìˆœì„œ ë³´ì¥ | timestamp ê¸°ë°˜ ì²˜ë¦¬ |

---

## 7. ëª¨ë‹ˆí„°ë§/ë¶„ì„ ì—°ë™

### 7.1 ì—ëŸ¬ ì¶”ì  (Sentry)

```typescript
// ì´ˆê¸°í™”
Sentry.init({
  dsn: process.env.SENTRY_DSN,
  environment: process.env.NODE_ENV,
  tracesSampleRate: 0.1,
});

// ì—ëŸ¬ ìº¡ì²˜
Sentry.captureException(error, {
  tags: { module: 'payment' },
  extra: { orderId: order.id },
});
```

### 7.2 ë¶„ì„ (Amplitude)

```typescript
// ì´ë²¤íŠ¸ ì¶”ì 
amplitude.track('purchase_completed', {
  order_id: order.id,
  amount: order.total,
  items: order.items.length,
});
```

---

## 8. Rate Limiting & ì¬ì‹œë„

### 8.1 ì œê³µì‚¬ë³„ í•œë„

| ì„œë¹„ìŠ¤ | Rate Limit | ì´ˆê³¼ ì‹œ |
|-------|-----------|---------|
| Stripe | 100 req/s | 429 + Retry-After |
| SendGrid | 600 req/min | 429 |
| S3 | 3,500 PUT/s | 503 |

### 8.2 ì¬ì‹œë„ ì „ëµ

```typescript
const retryConfig = {
  maxRetries: 3,
  baseDelay: 1000,      // 1ì´ˆ
  maxDelay: 30000,      // 30ì´ˆ
  factor: 2,            // exponential
  retryableErrors: [429, 500, 502, 503, 504],
};
```

---

## 9. í…ŒìŠ¤íŠ¸ ì „ëµ

### 9.1 í™˜ê²½ë³„ ì„¤ì •

| í™˜ê²½ | ì—°ë™ ë°©ì‹ |
|-----|----------|
| Unit Test | Mock ì‚¬ìš© |
| Integration | Sandbox API |
| Staging | Sandbox API |
| Production | Live API |

### 9.2 í…ŒìŠ¤íŠ¸ ë°ì´í„°

| ì„œë¹„ìŠ¤ | í…ŒìŠ¤íŠ¸ ë°ì´í„° |
|-------|-------------|
| Stripe | `4242 4242 4242 4242` (ì„±ê³µ) |
| Stripe | `4000 0000 0000 0002` (ê±°ì ˆ) |
| OAuth | í…ŒìŠ¤íŠ¸ ê³„ì • ì‚¬ìš© |

---

## 10. ê´€ë ¨ ë¬¸ì„œ

- [API ëª…ì„¸](./service-spec.md) - ë‚´ë¶€ API
- [í™˜ê²½ ì„¤ì •](./env-config.md) - API í‚¤ ê´€ë¦¬
- [ì—ëŸ¬ ì½”ë“œ](./error-codes.md) - ì—ëŸ¬ ì •ì˜
- [ë³´ì•ˆ ëª…ì„¸](./security-spec.md) - ì¸ì¦/ì•”í˜¸í™”

---

## ë³€ê²½ ì´ë ¥

| ë²„ì „ | ë‚ ì§œ | ì‘ì„±ì | ë³€ê²½ ë‚´ìš© |
|------|------|--------|----------|
| 1.0.0 | {{DATE}} | tsq-planner | ì´ˆê¸° ì‘ì„± |
